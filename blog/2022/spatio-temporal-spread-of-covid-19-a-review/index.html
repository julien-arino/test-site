<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="zrOU6pP7sLlXf7f0kW-NZRV1lZtdpybCfrJ3BeBMHQM"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Spatio-temporal spread of COVID-19: considerations and modelling | Julien Arino</title> <meta name="author" content="Julien Arino"> <meta name="description" content="A review of the spatio-temporal spread of COVID-19, both in terms of actual spread and in terms of modelling, that I wrote for Fields Institute Communications."> <meta name="keywords" content="mathematical-epidemiology, mathematical-biology"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://julien-arino.github.io/blog/2022/spatio-temporal-spread-of-covid-19-a-review/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> <meta name="generator" content="Jekyll v4.4.1"> <meta property="og:title" content="Spatio-temporal spread of COVID-19: considerations and modelling"> <meta property="og:locale" content="en"> <meta name="description" content="A review of the spatio-temporal spread of COVID-19, both in terms of actual spread and in terms of modelling, that I wrote for Fields Institute Communications."> <meta property="og:description" content="A review of the spatio-temporal spread of COVID-19, both in terms of actual spread and in terms of modelling, that I wrote for Fields Institute Communications."> <link rel="canonical" href="https://julien-arino.github.io/blog/2022/spatio-temporal-spread-of-covid-19-a-review/"> <meta property="og:url" content="https://julien-arino.github.io/blog/2022/spatio-temporal-spread-of-covid-19-a-review/"> <meta property="og:site_name" content="blank"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2022-02-15T00:00:00+00:00"> <meta name="twitter:card" content="summary"> <meta property="twitter:title" content="Spatio-temporal spread of COVID-19: considerations and modelling"> <meta name="google-site-verification" content="zrOU6pP7sLlXf7f0kW-NZRV1lZtdpybCfrJ3BeBMHQM"> <script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-02-15T00:00:00+00:00","datePublished":"2022-02-15T00:00:00+00:00","description":"A review of the spatio-temporal spread of COVID-19, both in terms of actual spread and in terms of modelling, that I wrote for Fields Institute Communications.","headline":"Spatio-temporal spread of COVID-19: considerations and modelling","mainEntityOfPage":{"@type":"WebPage","@id":"https://julien-arino.github.io/blog/2022/spatio-temporal-spread-of-covid-19-a-review/"},"url":"https://julien-arino.github.io/blog/2022/spatio-temporal-spread-of-covid-19-a-review/"}</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Julien </span>Arino</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/students/">students</a> </li> <li class="nav-item "> <a class="nav-link" href="/talks/">talks</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Spatio-temporal spread of COVID-19: considerations and modelling</h1> <p class="post-meta">February 15, 2022</p> <p class="post-tags"> <a href="/blog/2022"> <i class="fas fa-calendar fa-sm"></i> 2022 </a>   ·   <a href="/blog/category/data"> <i class="fas fa-tag fa-sm"></i> data</a>   <a href="/blog/category/r"> <i class="fas fa-tag fa-sm"></i> R</a>   </p> </header> <article class="post-content"> <p>The paper I briefly present here together with some of the code used to generate figures, was published as “Describing, Modelling and Forecasting the Spatial and Temporal Spread of COVID-19: A Short Review” in <em>Fields Institute Communications</em> <strong>85</strong>:25-51 (2022). It can be downloaded <a href="https://doi.org/10.1007/978-3-030-85053-1_2" rel="external nofollow noopener" target="_blank">here</a> or from my webpage <a href="https://server.math.umanitoba.ca/~jarino/publications/Arino-2022-FIC85.pdf" rel="external nofollow noopener" target="_blank">here</a>. An older version is available on arXiv <a href="https://arxiv.org/pdf/2102.02457.pdf" rel="external nofollow noopener" target="_blank">here</a>.</p> <p>In the paper, I review several different aspects.</p> <ol> <li>The general context of mathematical models of the spatio-temporal spread of infectious pathogens.</li> <li>The details of how the first wave (mostly) of COVID-19 spread.</li> <li>Some spatio-temporal models that were considered specifically for COVID-19.</li> </ol> <p>Refer to the paper for details. Here, I describe how the data was gathered and the figures were produced.</p> <h1 id="collecting-data-on-initial-spread">Collecting data on initial spread</h1> <p>There are different sources for case data, but my favourite when considering the world-level situation is the one curated by JHSSE. I have an <code class="language-plaintext highlighter-rouge">R</code> script that pulls the data and performs basic pre-processing. This script is in turn called by a short <code class="language-plaintext highlighter-rouge">bash</code> script that runs in <code class="language-plaintext highlighter-rouge">cron</code>, so that data pulling happens every day. Note that the data on initial spread is not concerned by this pull operation, I am just detailing this point here for completeness.</p> <p>The JHSSE site is, understandably, concerned about the current and future evolution of COVID-19 and thus the data on the initial spread needs to be investigated further. For this, I relied on a combination of Wikipedia and Google News search, threw in some GISAID data..</p> <h1 id="the-tsa-data">The TSA data</h1> <p>If you have initiated an public airplane trip in the USA in the past few years, you know the system. For those who have not, here is how things work. From the unsecured area in an airport, the first security check involves showing your boarding pass and an identification document to a Transportation Security Administration (<a href="https://www.tsa.gov/" rel="external nofollow noopener" target="_blank">TSA</a>) officer who verifies both before allowing you to proceed with the remainder of the checks (baggage and body scan, etc.) to admit you into the secure zone of the airport.</p> <p>When considering air travel, this data is very interesting. Indeed, one is checked only in the first airport of a trip, regardless of the number of connecting flights taken; this means that the data is quite representative of the number of trips initiated in the USA on a given day. The TSA records how many of these checks happen and reports this data openly; it is available <a href="https://www.tsa.gov/coronavirus/passenger-throughput" rel="external nofollow noopener" target="_blank">here</a>.</p> <p>Interestingly, the data is provided “shifted”, i.e., the year to year difference is shown in terms of corresponding day of the week. Comparing, say, 3 January 2021 (a Sunday) and 3 January 2022 (a Monday) makes little sense. However, this means that while the table can be consumed “as is” for a plot comparing yearly numbers of checks, it also needs to be processed a little before being stored or used for anything not straightforward. This is further required because of the presentation of the table, which has the latest data posted as the top row, decreasing dates, then wraps around and has the next missing date as the last day. For instance, writing this on 15 February, the table has 14 February as its top row, decreasing days, then has 16 February as its last row (because 16 February 16 corresponds to 15 February last year).</p> <p>So let us dig into this data. First, the basics. Let us grab the data and clean it.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Grab the data</span><span class="w">
</span><span class="n">tsa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htmltab</span><span class="o">::</span><span class="n">htmltab</span><span class="p">(</span><span class="s2">"https://www.tsa.gov/coronavirus/passenger-throughput"</span><span class="p">,</span><span class="w">
                       </span><span class="n">which</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">rm_nodata_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="c1"># Slight change of column names for convenience</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">tsa</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"date"</span><span class="p">,</span><span class="w"> </span><span class="s2">"vol2022"</span><span class="p">,</span><span class="w"> </span><span class="s2">"vol2021"</span><span class="p">,</span><span class="w"> </span><span class="s2">"vol2020"</span><span class="p">,</span><span class="w"> </span><span class="s2">"vol2019"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Get rid of thousands separators, make numbers</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"vol2022"</span><span class="p">,</span><span class="s2">"vol2021"</span><span class="p">,</span><span class="s2">"vol2020"</span><span class="p">,</span><span class="s2">"vol2019"</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="n">tsa</span><span class="p">[[</span><span class="n">c</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">","</span><span class="p">,</span><span class="w"> </span><span class="n">replacement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tsa</span><span class="p">[[</span><span class="n">c</span><span class="p">]])</span><span class="w">
   </span><span class="n">tsa</span><span class="p">[[</span><span class="n">c</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">tsa</span><span class="p">[[</span><span class="n">c</span><span class="p">]])</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># Make dates proper</span><span class="w">
</span><span class="n">tsa</span><span class="o">$</span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lubridate</span><span class="o">::</span><span class="n">mdy</span><span class="p">(</span><span class="n">tsa</span><span class="o">$</span><span class="n">date</span><span class="p">)</span></code></pre></figure> <p>If we want to plot things with the latest day in the data as the first day, things are easy. Note that we use the “axis prettyfier” that I presented <a href="https://julien-arino.github.io/2018/US-plotting-nice-axes-and-cropping">here</a>.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Get range of values to plot and compute pretty y axis</span><span class="w">
</span><span class="n">y_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">tsa</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="m">5</span><span class="p">],</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">y_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">tsa</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="m">5</span><span class="p">],</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">y_range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_y_axis</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span><span class="w"> </span><span class="n">y_max</span><span class="p">))</span><span class="w">
</span><span class="c1"># Make a colour palette</span><span class="w">
</span><span class="n">my_palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"dodgerblue%d"</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="c1"># Start the plot. Plot 2019</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">tsa</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">tsa</span><span class="o">$</span><span class="n">vol2019</span><span class="o">*</span><span class="n">y_range</span><span class="o">$</span><span class="n">factor</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"l"</span><span class="p">,</span><span class="w">
     </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span><span class="n">y_max</span><span class="p">)</span><span class="o">*</span><span class="n">y_range</span><span class="o">$</span><span class="n">factor</span><span class="p">,</span><span class="w">
     </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w">
     </span><span class="n">xaxs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"i"</span><span class="p">,</span><span class="w"> </span><span class="n">yaxt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Month"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Travellers screened"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Plot remaining years</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2020</span><span class="o">:</span><span class="m">2022</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">vol_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"vol%d"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">
  </span><span class="n">lines</span><span class="p">(</span><span class="n">tsa</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">tsa</span><span class="p">[[</span><span class="n">vol_y</span><span class="p">]]</span><span class="o">*</span><span class="n">y_range</span><span class="o">$</span><span class="n">factor</span><span class="p">,</span><span class="w">
        </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my_palette</span><span class="p">[</span><span class="m">2023</span><span class="o">-</span><span class="n">y</span><span class="p">])</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># Throw in the axis, legend..</span><span class="w">
</span><span class="n">axis</span><span class="p">(</span><span class="n">side</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y_range</span><span class="o">$</span><span class="n">ticks</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y_range</span><span class="o">$</span><span class="n">labels</span><span class="p">,</span><span class="w"> </span><span class="n">las</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bottomright"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"2019"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2020"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2021"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2022"</span><span class="p">),</span><span class="w"> 
       </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> 
       </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">my_palette</span><span class="p">),</span><span class="w">
       </span><span class="n">inset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">)</span></code></pre></figure> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/TSA_screens-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/TSA_screens-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/TSA_screens-1400.webp"></source> <img src="/assets/img/TSA_screens.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="TSA checks" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Okay, this is a little confusing. The most recent data is in the top right, the blue curve over the red one.</p> <p>Things become a little hairier if one wants to, say, plot all the data in sequence rather than in parallel, i.e., plot all dates from 2019 to today. Of course, the table provided by the TSA is itself created from data that is in the format we want, but as far as I am able to tell, the table we downloaded earlier is the only way for the public to access that data. (If anybody knows if the data is on an Open Data server such as <a href="https://www.data.gov/" rel="external nofollow noopener" target="_blank">data.gov</a> in unedited form, drop me an email.)</p> <p>To get a sense of what needs to be done, let us first look at several interesting places in the table: the top (the most recent data points), the switching point between calendar years and the bottom (with the soon to be filled information). Looking at the situation today (15 February 2022), this is what we have.</p> <table class="table-striped"> <thead> <tr> <th style="text-align: left">date</th> <th style="text-align: right">vol2022</th> <th style="text-align: right">vol2021</th> <th style="text-align: right">vol2020</th> <th style="text-align: right">vol2019</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">2022-02-14</td> <td style="text-align: right">1731473</td> <td style="text-align: right">967693</td> <td style="text-align: right">2494922</td> <td style="text-align: right">1922613</td> </tr> <tr> <td style="text-align: left">2022-02-13</td> <td style="text-align: right">1815824</td> <td style="text-align: right">946458</td> <td style="text-align: right">2198657</td> <td style="text-align: right">2227730</td> </tr> <tr> <td style="text-align: left">2022-02-12</td> <td style="text-align: right">1534080</td> <td style="text-align: right">900696</td> <td style="text-align: right">1972248</td> <td style="text-align: right">1950385</td> </tr> <tr> <td style="text-align: left">2022-02-11</td> <td style="text-align: right">1914374</td> <td style="text-align: right">1151420</td> <td style="text-align: right">2507588</td> <td style="text-align: right">1620239</td> </tr> <tr> <td style="text-align: left"> </td> <td style="text-align: right"> </td> <td style="text-align: right"> </td> <td style="text-align: right"> </td> <td style="text-align: right"> </td> </tr> <tr> <td style="text-align: left">2022-01-02</td> <td style="text-align: right">2023309</td> <td style="text-align: right">1327289</td> <td style="text-align: right">2422272</td> <td style="text-align: right">2202111</td> </tr> <tr> <td style="text-align: left">2022-01-01</td> <td style="text-align: right">1616316</td> <td style="text-align: right">1192881</td> <td style="text-align: right">2178656</td> <td style="text-align: right">2345103</td> </tr> <tr> <td style="text-align: left">2021-12-31</td> <td style="text-align: right">NA</td> <td style="text-align: right">1650795</td> <td style="text-align: right">805990</td> <td style="text-align: right">2311732</td> </tr> <tr> <td style="text-align: left">2021-12-30</td> <td style="text-align: right">NA</td> <td style="text-align: right">2049604</td> <td style="text-align: right">874406</td> <td style="text-align: right">2392331</td> </tr> <tr> <td style="text-align: left"> </td> <td style="text-align: right"> </td> <td style="text-align: right"> </td> <td style="text-align: right"> </td> <td style="text-align: right"> </td> </tr> <tr> <td style="text-align: left">2021-02-19</td> <td style="text-align: right">NA</td> <td style="text-align: right">1059452</td> <td style="text-align: right">2429489</td> <td style="text-align: right">2022861</td> </tr> <tr> <td style="text-align: left">2021-02-18</td> <td style="text-align: right">NA</td> <td style="text-align: right">914823</td> <td style="text-align: right">2358511</td> <td style="text-align: right">2177690</td> </tr> <tr> <td style="text-align: left">2021-02-17</td> <td style="text-align: right">NA</td> <td style="text-align: right">773422</td> <td style="text-align: right">2129862</td> <td style="text-align: right">2476445</td> </tr> <tr> <td style="text-align: left">2021-02-16</td> <td style="text-align: right">NA</td> <td style="text-align: right">738825</td> <td style="text-align: right">2190300</td> <td style="text-align: right">2147045</td> </tr> </tbody> </table> <p>My interpretation (which could very well be wrong) of this table is the following. The days in 2022 (until the point where the 2022 column starts to contains NA) are the “real” week days. 2022-02-14, for instance, was a Monday. Then in the remaining columns on that row, we find the closest Monday: in 2021, this was 2021-02-15, in 2020, 2020-02-17 (yay for leap years!) and in 2019, 2020-02-18.</p> <p>Then, once the 2022 column starts to contain NAs because the data points would be in the future, the same becomes true with the 2021 dates remaining. But this leaves some questions:</p> <ol> <li>How was 2020-02-29 dealt with?</li> <li>How are years patched together?</li> <li>Can the overall time series be recomposed by taking the rows from vol2022 from 2022-02-14 to 2022-01-01, ten the rows from vol2021 from 2021-120-31 to 2021-02-16, then the rows from vol2021 from 2022-02-14 to 2022-01-01, etc.?</li> </ol> <p>Altogether: it would be really nice if the TSA put the time series on data.gov! In the meantime, let us assemble the data in sequence and accept the fact that there probably will be issues with the exact dates.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Find 1 January in dates</span><span class="w">
</span><span class="n">idx_Jan01</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">which</span><span class="p">(</span><span class="n">tsa</span><span class="o">$</span><span class="n">date</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">lubridate</span><span class="o">::</span><span class="n">ymd</span><span class="p">(</span><span class="s2">"2022-01-01"</span><span class="p">))</span><span class="w">
</span><span class="c1"># Where we will store the result</span><span class="w">
</span><span class="n">tsa.ts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">()</span><span class="w">
</span><span class="c1"># Assume all year cutoffs are at the same point on each row</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">tsa.ts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">tsa.ts</span><span class="p">,</span><span class="w"> </span><span class="n">tsa</span><span class="p">[</span><span class="n">idx_Jan01</span><span class="m">+1</span><span class="o">:</span><span class="nf">dim</span><span class="p">(</span><span class="n">tsa</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">c</span><span class="p">])</span><span class="w">
  </span><span class="n">tsa.ts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">tsa.ts</span><span class="p">,</span><span class="w"> </span><span class="n">tsa</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">idx_Jan01</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">])</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># Get rid of the NAs we put in there..</span><span class="w">
</span><span class="n">tsa.ts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tsa.ts</span><span class="p">[</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">tsa.ts</span><span class="p">)]</span><span class="w">
</span><span class="c1"># Make a data frame</span><span class="w">
</span><span class="n">tsa.ts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
  </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="n">tsa</span><span class="o">$</span><span class="n">date</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">-</span><span class="nf">length</span><span class="p">(</span><span class="n">tsa.ts</span><span class="p">)</span><span class="m">+1</span><span class="p">,</span><span class="w"> </span><span class="n">tsa</span><span class="o">$</span><span class="n">date</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"day"</span><span class="p">),</span><span class="w">
  </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">tsa.ts</span><span class="p">[</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">tsa.ts</span><span class="p">)]))</span></code></pre></figure> <p>Let us plot the result. We will add a moving average, so define the following function.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ma</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">sides</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">stats</span><span class="o">::</span><span class="n">filter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">sides</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sides</span><span class="p">)</span><span class="w">
</span><span class="p">}</span></code></pre></figure> <p>Note that we specify that the filter function is the one from the <code class="language-plaintext highlighter-rouge">stats</code> library (the default one). This is important in case we use the <code class="language-plaintext highlighter-rouge">dplyr</code> library, which redefines the function. We get the following figure, in which the red is the moving average</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/TSA_screens_ts-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/TSA_screens_ts-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/TSA_screens_ts-1400.webp"></source> <img src="/assets/img/TSA_screens_ts.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="TSA checks as time series" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Whether the cutoffs are appropriate remains to be seen..</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Julien Arino. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: February 02, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-97QKRGST95"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-97QKRGST95");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>